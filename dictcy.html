<!DOCTYPE html><html><head><script>
let appref='dictcyhtml';
</script>
<style>
textarea {font-family:Times New Roman;font-size:70%;padding:5px;margin:0px;}
button {height:15px;font-family:Times New Roman;font-size:70%;padding-left:2px;padding-right:2px;}
select {font-family:Times New Roman;font-size:70%;}
body {font-family:Times New Roman;font-size:70%;}
.btndict {background-color:#ffffdd;border:1px solid gray;border-radius:4px;}
</style>
<script src='../../jsproj/txutilsjs/txutils.js'></script>
<meta charset='UTF-8'/>
<meta name='viewport' content='width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=0' />
</head>
<body>
<b>
github.com/ianlow27/dictcyhtml
</b>
- 0.0.3_241226-1341
|dictcyhtml provides dictionary lookup and related facilities for words to and from Welsh
|Author: Ian Low
|Copyright (c) 2024 Ian Low
|Usage Rights: MIT License
<br/>
<select id='selfiles' onchange='selfile();'>
</select>
<span id='spstatus' style='color:blue;'></span>
<br/>
<!-- ================================= -->
<textarea id='tx1' style='xmargin-top:-10px;resize:none;overflow-y:auto;width:92%;max-height:70px;height:70px;
  -webkit-overflow-scrolling: touch;'></textarea>
<div style='margin-top:-4px;margin-bottom:-4px;'>
<button id='btrgxrpl' onclick='rgxreplace();'>Rgx Replace</button>
<button id='btsort' onclick='sorttext();'>Sort</button>
<button id='btcopy' onclick='copy2clipbrd();'>Copy</button>
<button id='btsave' onclick='savetext();'>Save</button>
<button id='btrestore' onclick='restoretext("cnfrm");'>Restore</button>
<button id='btnewfile' onclick='newfile();'>New File</button>
<button id='btnrnmfile' onclick='renamefile();'>Rename File</button>
<button id='btdelfile' onclick='delfile();'>Delete File</button>
</div>
<table width='96%'>
<tr>
<td width='60%' valign='top'>
<textarea id='tx2' class='btndict' style='width:92%;height:70px;'></textarea>
<textarea id='tx3' style='width:92%;height:50px;'></textarea>
</td>
<td width='40%' valign='top'>
<textarea id='tx4' style='width:92%;height:70px;'></textarea>
<textarea id='tx5' style='width:92%;height:50px;'></textarea>
</td>
</tr>
</table>

<!-- ================================= -->
<div style='margin-top:-7px;margin-bottom:-6px;'> 
<button class='btndict' id='btrdict' onclick='dict("2cy");'>Dict2CY</button>
<button class='btndict' id='btrdict' onclick='dict("2en");'>Dict2EN</button>
<button class='btndict' id='btrdict' onclick='cleandict("finddups");'>FindDups</button>
<button class='btndict' id='btrdict' onclick='cleandict("newdict");'>NewDict</button>
<button class='btndict' id='btrdict' onclick='dict("2en");'>?</button>
<button class='btndict' id='btrdict' onclick='dict("2en");'>?</button>

<button class='btndict' id='btrdict' onclick='dict("2en");'>?</button>
<button class='btndict' id='btrdict' onclick='dict("2en");'>?</button>
<button class='btndict' id='btrdict' onclick='dict("2en");'>?</button>
<button class='btndict' id='btrdict' onclick='dict("2en");'>?</button>
<button class='btndict' id='btrdict' onclick='dict("2en");'>?</button>
<button class='btndict' id='btrdict' onclick='dict("2en");'>?</button>
</div>

<pre id='pr1'><pre>

<script src='./dictcy.js'></script>
<script src='./correctns.js'></script>
<script>

alert(acorrectns.length);
alert(adictcy.length);
resize2device();
//localStorage.removeItem(appref+'_new4');
//localStorage.setItem(appref+'_currfile','new1');
//localStorage.setItem(appref+'_listfiles','new1%%%new2%%%new3');
let bautosave=true;
  
let fname=localStorage.getItem(appref+'_currfile');
//alert(fname);
const tx1=document.getElementById('tx1');
const tx2=document.getElementById('tx2');
const tx3=document.getElementById('tx3');
const tx4=document.getElementById('tx4');
const tx5=document.getElementById('tx5');
const pr1=document.getElementById('pr1');
const spstatus=document.getElementById('spstatus');
const selfiles=document.getElementById('selfiles');
popselfiles();
try{
restoretext();
}catch(e){
  alert(e.message);
}
tx2.value=localStorage.getItem(appref+'_tx2');
tx3.value=localStorage.getItem(appref+'_tx3');
tx4.value=localStorage.getItem(appref+'_tx4');
tx5.value=localStorage.getItem(appref+'_tx5');
setInterval('savetext();', 3*20*1000);
cleandict('newdict','onload');
//-------------------------------------------
function runmsg(popt){
  const dtnow = new Date();
  spstatus.innerHTML=popt+' '+dtnow.toISOString();
}//endfunc
//-------------------------------------------!!
function dict(popt){//!!
runmsg('started');
localStorage.setItem(appref+'_tx1', tx1.value);
localStorage.setItem(appref+'_tx2', tx2.value);
localStorage.setItem(appref+'_tx3', tx3.value);
localStorage.setItem(appref+'_tx4', tx4.value);
localStorage.setItem(appref+'_tx5', tx5.value);
let strout='';
if(tx1.value.length > 2000){
  runmsg('stopped');
  alert('tx1 is too large!');
  return;
}
const awords=tx1.value.split(/\s/);
let colsrc=1;
let coltgt=2;
  if(popt=='2en'){
    colsrc=2;
    coltgt=1;
  }
  for(i in awords){
    //alert(awords[i]);
    //const rgx=RegExp("/\|"+awords[i]+"\|/");
    strout+=' '+awords[i];
    let fndwds='';
    for(j in adictcy){
      const atmp1=adictcy[j].split(/\|/);
      if(atmp1[colsrc]==awords[i]){
        if(fndwds=='') fndwds+='=';
        else fndwds+='/';
        fndwds+=''+atmp1[coltgt]+'('+atmp1[3]+')';//!! alert(atmp1[1]+'____'+awords[i]+'___'+adictcy[j]);
      }else {
             // strout+=' ';
      }
    }//endfor
    strout+=fndwds;
  }//endfor
 tx2.value= strout;
 localStorage.setItem(appref+'_tx2', tx2.value);
 runmsg('completed');
}//endfunc
//-------------------------------------------
/* popts=finddups/newdict */
function cleandict(popt, popt2=''){
runmsg('started');
let prv1='';
let prv2='';
let prv3='';
let strout='';
let anewdict=Array();
let adict2=Array();
  if(popt=='newdict'){
    let atmp1=Array();
    if(popt2=='onload'){
      atmp1=acorrectns;
    }else {
      atmp1=tx1.value.split(/\n/);
    }
    for(let i in atmp1){
      const atmp2=atmp1[i].split(/#/);
      if(String(atmp2[1]).trim()){
        anewdict[atmp2[0]]=atmp2[1];
      }
      //if(i>20) break;
    }//endfor
    //alert(anewdict.length);
    strout+='const adictcy  = [\n';
  }//endif
  //alert(1);
  let count=0;
  for(let i in adictcy){
    count++;
    if(!(count%10000)){
      alert(count+' of '+adictcy.length);
      //if(count>10000) break;
    }
    if(popt=='finddups'){
      let atmp1=adictcy[i].split(/\|/);
      if(i){
        if((prv1==atmp1[1])&&(prv2==atmp1[2])){
         strout+=adictcy[i-1]+"\n";
         strout+=adictcy[i]+"\n" 
        }//endif
      }
      prv1=atmp1[1];
      prv2=atmp1[2];
      prv3=atmp1[3];     
    }else if(popt=='newdict'){
      let bfound=false;
      for(let j in anewdict){
        if((j+'#')==adictcy[i]){
          bfound=true;
          let atmp3=anewdict[j].split(/\//);
          let bincl=true;
          if(atmp3[0]=='x'){
            bincl=false;
            //alert(j);
          }
          if(bincl){
            let atmp4=adictcy[i].split(/\|/);
            for(let k in atmp3){
              if(atmp3[k].match(/>/)){
                const atmp5=atmp3[k].split(/>/);
                atmp4[Number(atmp5[0])]=atmp5[1];
              }else{
              }//endif
            }//endfor
            let str1='';
            for(let k in atmp4){
              if(str1!='') str1+='|';
              str1+=atmp4[k];
            }//endfor
            //alert(str1+'#');
            if(popt2=='onload'){
              adict2.push(str1);
            }else {
              strout+='"'+str1+'",\n';
            }
          }//endif
//alert(j+'');
        }
      }//endfor
      if(!bfound){
        if(popt2=='onload'){
          adict2.push(adictcy[i]);          
        }else {
          strout+='"'+adictcy[i]+'",\n';
        }
      }//endif
    }//endif
//if(i>5)break;
  }//endfor
  if(popt=='finddups'){
    tx2.value=strout;
  }else if(popt=='newdict'){
    strout+='""];\n';
    strout+='const dictcyjs_loaded=true;\n';
    strout+='if(dictcyjs_loaded){ console.log(dictcyjs["54433"]);\n';
    strout+='}\n';
   // pr1.innerHTML=strout;
    //alert(strout.substr(0,10));
    //alert(strout.substr(10,20));
    //alert(strout.substr(20,30));
    if(popt2=='onload'){    
      adictcy=adict2;
    }else {    
      tx2.value=strout; //.substr(0,5000);
    }
    //copy2clipboard(tx2);
  }//endif

  runmsg('completed');
}//endfunc
//-------------------------------------------
//-------------------------------------------
//-------------------------------------------
//-------------------------------------------
//-------------------------------------------
function sorttext(){
  if(promptyn('Do you want to sort this file?  - '+fname)!='y') return 0;
  const alines=tx1.value.split(/\n/);
  alines.sort();
  let strout='';
  for(let i in alines){
    strout+=alines[i]+'\n';
  }
  tx1.value=strout.trim();
}//endfunc
//-------------------------------------------
function savetext(pname=''){

  if(pname==''){
    if(!bautosave) return -1;
    pname=fname;
  }
  localStorage.setItem(appref+'_'+pname,tx1.value);
  const dtnow = new Date();
  spstatus.innerHTML='saved '+dtnow.toISOString();
  //alert(pname+'______'+localStorage.getItem(appref+'_'+pname));
  setTimeout("spstatus.innerHTML='';",3000);
}//endfunc
//-------------------------------------------
function restoretext(popt='nocnfrm'){
   if(popt=='cnfrm')
     if(promptyn('Do you want to restore this file?  - '+fname)!='y') return 0;
  fname=localStorage.getItem(appref+'_currfile');
  tx1.value = localStorage.getItem(appref+'_'+fname);
}//endfunc
//---------------------------------
function copy2clipbrd(){
  savetext();
bautosave=false;
  const strorig=tx1.value;
  //alert(1);
  const afiles=localStorage.getItem(appref+'_listfiles').split('%%%');
  let strout='';
  //----------------------
  try{
    //alert(2);
  for(i in afiles){
    strout+='\n~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~\n';
    strout+='['+afiles[i]+']:\n';
    strout+=localStorage.getItem(appref+'_'+afiles[i]);
    strout+='\n\n';
  }//endfor
  }catch(e){
     alert(e.message);
   }
  tx1.value=strout;
  //alert(strout);
  //------------------------
  try{
    //_alert(strorig);
    localStorage.setItem(appref+'_strorig',strorig);
  setTimeout('rev2strorig();',4000);
    copy2clipboard(tx1);
  
  
  }catch(e){
    alert(e.message);
  }
}//endfunc
//-----------------------------------------
function rev2strorig(){
    try{
  //tx1.value='';
  //alert(1);
   const str1=localStorage.getItem(appref+'_strorig');
 // alert(str1);
   tx1.value=str1;
    }catch(e){
    alert(e.message);
  }
  bautosave=true;
}
//-------------------------------------------
function newfile(pname=''){
  if(pname=='') pname = prompt('Please enter the name of the new file:');
  if(pname == null) return 0;
  //alert(fname);
  localStorage.setItem(appref+'_currfile', pname);

  localStorage.setItem(appref+'_listfiles',
     sortuniq(localStorage.getItem(appref+'_listfiles')+'%%%'+pname,'%%%'));
  fname=pname;
  location.reload();
}//endfunc
//-------------------------------------------
function popselfiles(popt='start'){
try{
  let idx=0;
  selfiles.innerHTML='';
  const afiles=localStorage.getItem(appref+'_listfiles').split('%%%');
  for(i in afiles){
    var opt = document.createElement('option');
    if((i==0)&&(popt=='del')){
      fname=afiles[i];
      localStorage.setItem(appref+'_currfile', fname);
      //alert('___'+fname);
    }
    if((fname==afiles[i])&&(popt=='start')){
      idx=i;
    }
    opt.value = afiles[i];
    opt.innerHTML = afiles[i];
    selfiles.appendChild(opt)
  }
  selfiles.selectedIndex=idx;
  //localStorage.setItem(appref+'_currfile', fname);localStorage.setItem(appref+'_currfile', fname);
  
}catch(e){
  alert(e.message);
}
}//endfunc
//-------------------------------------------
function selfile(){
  savetext();
  fname=(selfiles[selfiles.selectedIndex].value);
  localStorage.setItem(appref+'_currfile', fname);
  restoretext();
}//endfunc
//-------------------------------------------
function delfile(pname=''){
  try{
    if(pname==''){
      fname=(selfiles[selfiles.selectedIndex].value);
      pname=fname;
      if(promptyn('Do you want to delete this file?  - '+pname)!='y') return 0;
    }
  }catch(e){
    alert(e.message);
  }
 
 localStorage.removeItem(appref+'_'+pname);
 let listfiles=localStorage.getItem(appref+'_listfiles');
 listfiles='%%%'+listfiles+'%%%';

 let rgx=new RegExp('%%%'+pname+'%%%');
 listfiles=
   listfiles
     .replace(rgx,'%%%')
     .replace(/^%%%/,'')
     .replace(/%%%$/,'')
         ;
 //alert(listfiles);
  localStorage.setItem(appref+'_listfiles',listfiles);
  try{
 popselfiles('del');
 location.reload();
}catch(e){
  alert(e.message);
 }
}//endfunc
//-------------------------------------------
function renamefile(){
  bautosave=false;
  let newname='';
  try{
    newname=prompt('New file name for '+fname+':');
    if(!newname.match(/[a-zA-Z]+/)) return 0;
  }catch(e){
    return 0;
    alert(e.message);
  }
  //alert(newname);
  savetext(newname);
  delfile(fname);
  newfile(newname);
  bautosave=true;
}//endfunc
//-------------------------------------------
function rgxreplace(){
//(\d\d)\sJan\s(\d\d\d\d)%%%$2-01-$1###(\d\d)\sFeb\s(\d\d\d\d)%%%$2-02-$1###(\d\d)\sMar\s(\d\d\d\d)%%%$2-03-$1###(\d\d)\sApr\s(\d\d\d\d)%%%$2-04-$1###(\d\d)\sMay\s(\d\d\d\d)%%%$2-05-$1###(\d\d)\sJun\s(\d\d\d\d)%%%$2-06-$1###(\d\d)\sJul\s(\d\d\d\d)%%%$2-07-$1###(\d\d)\sAug\s(\d\d\d\d)%%%$2-08-$1###(\d\d)\sSep\s(\d\d\d\d)%%%$2-09-$1###(\d\d)\sOct\s(\d\d\d\d)%%%$2-10-$1###(\d\d)\sNov\s(\d\d\d\d)%%%$2-11-$1###(\d\d)\sDec\s(\d\d\d\d)%%%$2-12-$1
//(\d\d)/(\d\d)/(\d\d\d\d)%%%$3-$2-$1


//(\d\d)\sJan\s(\d\d\d\d)%%%$2-01-$1###(\d\d)\sFeb\s(\d\d\d\d)%%%$2-02-$1###(\d\d)\sMar\s(\d\d\d\d)%%%$2-03-$1###(\d\d)\sApr\s(\d\d\d\d)%%%$2-04-$1
//(\d\d)\sMay\s(\d\d\d\d)%%%$2-05-$1###(\d\d)\sJun\s(\d\d\d\d)%%%$2-06-$1###(\d\d)\sJul\s(\d\d\d\d)%%%$2-07-$1###(\d\d)\sAug\s(\d\d\d\d)%%%$2-08-$1
//(\d\d)\sSep\s(\d\d\d\d)%%%$2-09-$1###(\d\d)\sOct\s(\d\d\d\d)%%%$2-10-$1###(\d\d)\sNov\s(\d\d\d\d)%%%$2-11-$1###(\d\d)\sDec\s(\d\d\d\d)%%%$2-12-$1
  const lrgx = prompt('Please enter your regex match and replace patterns separated by a triple percentage sign (%%%) and different multiple replacements by a triple hash (###): ');
//alert(lrgx);
  if(lrgx == null) return -1;
alines = lrgx.split(/###/);
for(i in alines){
  alines[i] = alines[i].trim();
  argx = alines[i].split(/%%%/);
  if(typeof argx[1] == 'undefined') return -1;
  lrepl = argx[1];
  let str1 = tx1.value;
  const rgx = new RegExp(argx[0], 'mg');
  tx1.value = str1.replace(rgx, argx[1]);
}//endfor
}//endfunc
//-------------------------------------------
//endfunc
//-------------------------------------------
//endfunc
//-------------------------------------------
//endfunc
//-------------------------------------------
</script>
</body>
</html>


